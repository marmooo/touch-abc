import{Carousel}from"https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/+esm";const defaultFontFamily="Roboto",googleFontsURL=new URL("https://fonts.googleapis.com/css2"),googleFontsParams=new URLSearchParams;googleFontsParams.set("family",defaultFontFamily),googleFontsParams.set("display","swap"),googleFontsURL.search=googleFontsParams;const previewText="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwzyz",uppers="ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowers="abcdefghijklmnopqrstuvwzyz";loadConfig();function loadConfig(){if(localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark"),localStorage.getItem("touch-abc-level")){const e=parseInt(localStorage.getItem("touch-abc-level"));document.getElementById("levelOption").options[e].selected=!0}if(localStorage.getItem("touch-abc-font")){const e=localStorage.getItem("touch-abc-font");selectFontFromURLBase(e)}if(localStorage.getItem("furigana")==1){const e=document.getElementById("addFurigana");addFurigana(e),e.setAttribute("data-done",!0)}}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function getGoogleFontsURL(e){const t=new URLSearchParams;return t.set("family",e),t.set("text",previewText),t.set("display","swap"),googleFontsURL.search=t,googleFontsURL.toString()}async function loadGoogleFonts(e){const t=getGoogleFontsURL(e),n=await fetch(t),s=await n.text(),o=s.match(/url\(.+?\)/g);for(const n of o){const t=new FontFace(e,n);await t.load(),document.fonts.add(t)}}async function selectFontFromURLBase(e){try{const t=new URL(e);if(document.getElementById("fontLoadError").classList.add("d-none"),t.host==googleFontsURL.host){const e=new URLSearchParams(t.search).get("family"),n=getGoogleFontsURL(e);await loadGoogleFonts(e),localStorage.setItem("touch-abc-font",n),document.getElementById("selectedFont").style.fontFamily=e}else{const e="abc",n=new globalThis.FontFace(e,`url(${t})`);await n.load(),document.fonts.add(n),localStorage.setItem("touch-abc-font",t),document.getElementById("selectedFont").style.fontFamily=e}}catch(e){console.log(e),document.getElementById("fontLoadError").classList.remove("d-none")}}async function selectFontFromURL(){const e=document.getElementById("selectFontFromURL"),t=document.getElementById("fontLoading");e.classList.add("disabled"),t.classList.remove("d-none");const n=document.getElementById("fontURL").value;await selectFontFromURLBase(n),e.classList.remove("disabled"),t.classList.add("d-none")}function selectFont(e){const n=e.target.getAttribute("id"),t=n.replace(/-/g," "),s=getGoogleFontsURL(t);localStorage.setItem("touch-abc-font",s),document.getElementById("selectedFont").style.fontFamily=t}function changeLevel(e){const t=e.target.selectedIndex;localStorage.setItem("touch-abc-level",t)}function addFurigana(){const e=document.getElementById("addFurigana");e.getAttribute("data-done")?(localStorage.setItem("furigana",0),location.reload()):(import("https://marmooo.github.io/yomico/yomico.min.js").then(e=>{e.yomico("/touch-abc/index.yomi")}),localStorage.setItem("furigana",1),e.setAttribute("data-done",!0))}function setCleared(){const e=localStorage.getItem("touch-abc");if(e){const t=[...document.getElementById("problems").children];t.forEach(t=>{e.includes(t.textContent)&&(t.classList.remove("btn-outline-secondary"),t.classList.add("btn-secondary"))})}}function deleteData(){localStorage.removeItem("touch-abc"),location.reload()}function generateDrill(){const e=document.getElementById("search").value;e&&/^[a-zA-Z]+$/.test(e)&&(location.href=`/touch-abc/drill/?q=${e}`)}function setProblems(){let e="";const t=document.getElementById("problems"),n=uppers+lowers;Array.from(n).forEach(t=>{const n=t.repeat(6),s=`/touch-abc/drill/?q=${n}`,o="me-1 mb-1 btn btn-sm btn-outline-secondary";e+=`<a href="${s}" class="${o}">${t}</a>`}),t.innerHTML=e}setProblems(),setCleared();const fontsCarousel=document.getElementById("fontsCarousel");new Carousel(fontsCarousel),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("addFurigana").onclick=addFurigana,document.getElementById("generateDrill").onclick=generateDrill,document.getElementById("deleteData").onclick=deleteData,document.getElementById("selectFontFromURL").onclick=selectFontFromURL,[...fontsCarousel.getElementsByClassName("selectFont")].forEach(e=>{e.onclick=selectFont}),document.getElementById("levelOption").onchange=changeLevel,document.getElementById("search").addEventListener("keydown",e=>{if(e.key=="Enter"){const t=e.target.value;location.href=`/touch-abc/drill/?q=${t}`}}),document.getElementById("fontURL").addEventListener("keydown",e=>{e.key=="Enter"&&selectFontFromURL()})